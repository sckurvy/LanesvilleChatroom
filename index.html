<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Lanesville Chat</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: white;
    color: black;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    background-color: purple;
    color: white;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
  }
  #settings {
    cursor: pointer;
    font-size: 18px;
  }
  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
  }
  .message {
    margin-bottom: 10px;
    padding: 5px;
    border-radius: 5px;
    background: #f2f2f2;
  }
  .name {
    font-weight: bold;
  }
  .online-dot {
    height: 8px;
    width: 8px;
    background-color: limegreen;
    border-radius: 50%;
    display: inline-block;
    margin-right: 5px;
  }
  #input-area {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ccc;
    background-color: white;
  }
  #message-input {
    flex: 1;
    padding: 10px;
    border-radius: 20px;
    border: 1px solid #ccc;
    outline: none;
    font-size: 14px;
  }
  #send-btn, #img-btn {
    margin-left: 10px;
    border: none;
    border-radius: 50%;
    padding: 10px;
    cursor: pointer;
  }
  #img-btn {
    background: white;
    border: 1px solid black;
    font-size: 16px;
    font-weight: bold;
  }
  #send-btn {
    background-color: purple;
    color: white;
  }
  #settings-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border: 1px solid #ccc;
    display: none;
    z-index: 1000;
  }
</style>
</head>
<body>

<header>
  <span>Lanesville Chat</span>
  <span id="settings">⚙️</span>
</header>

<div id="chat"></div>

<div id="input-area">
  <input id="message-input" type="text" placeholder="Type a message..." />
  <button id="img-btn">+</button>
  <button id="send-btn">Send</button>
</div>

<div id="settings-modal">
  <h3>Settings</h3>
  <label>Name: <input type="text" id="name-input" /></label><br><br>
  <label>Theme: 
    <select id="theme-select">
      <option value="purplewhite">Purple/White</option>
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
  </label><br><br>
  <label>Admin Panel Code: <input type="text" id="admin-code" /></label><br><br>
  <button id="save-settings">Save</button>
</div>

<script>
const API = "https://lanesville-chat-backend.onrender.com";
let username = localStorage.getItem("chatName") || "";
let theme = localStorage.getItem("chatTheme") || "purplewhite";
let isAdmin = localStorage.getItem("isAdmin") === "true";

// Prompt for name if not set
if (!username) {
  username = prompt("Enter your name:") || "Guest";
  localStorage.setItem("chatName", username);
}
document.getElementById("name-input").value = username;
document.getElementById("theme-select").value = theme;

// Fetch and display messages
async function loadMessages() {
  let res = await fetch(API + "/messages");
  let msgs = await res.json();
  let chat = document.getElementById("chat");
  chat.innerHTML = "";
  msgs.forEach(msg => {
    let div = document.createElement("div");
    div.className = "message";
    let date = new Date(msg.time);
    let timeStr = date.toLocaleDateString() + " " + date.toLocaleTimeString();
    div.innerHTML = `<span class="name"><span class="online-dot"></span>${msg.name}</span> <small>${timeStr}</small><br>${msg.message}`;
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
}

// Send message
async function sendMessage() {
  let input = document.getElementById("message-input");
  let text = input.value.trim();
  if (!text) return;
  await fetch(API + "/messages", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ name: username, message: text })
  });
  input.value = "";
  loadMessages();
}

// Load messages every 2 seconds
setInterval(loadMessages, 2000);
loadMessages();

document.getElementById("send-btn").onclick = sendMessage;

// Settings modal
document.getElementById("settings").onclick = () => {
  document.getElementById("settings-modal").style.display = "block";
};
document.getElementById("save-settings").onclick = () => {
  username = document.getElementById("name-input").value || "Guest";
  theme = document.getElementById("theme-select").value;
  localStorage.setItem("chatName", username);
  localStorage.setItem("chatTheme", theme);
  if (document.getElementById("admin-code").value === "JohnTheJohnGuy") {
    isAdmin = true;
    localStorage.setItem("isAdmin", "true");
    alert("Admin mode enabled!");
  }
  document.getElementById("settings-modal").style.display = "none";
  loadMessages();
};
</script>

</body>
</html>
